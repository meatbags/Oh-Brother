var Brother=function(t){function e(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=e.Canvas=e.Loader=void 0;var s=i(1),n=r(s),a=i(2),h=r(a),o=i(3),c=r(o);e.Loader=n.default,e.Canvas=h.default,e.Parser=c.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){this.image=new Image,this.onload=null};r.prototype={load:function(t){this.image.onload=this.onload,this.image.src=t},getImageRaw:function(){return this.image}},e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){this.init()};r.prototype={init:function(){this.cvs={helper:document.createElement("canvas"),preview:document.createElement("canvas")},this.ctx={helper:this.cvs.helper.getContext("2d"),preview:this.cvs.preview.getContext("2d")},this.scale=3},drawImage:function(t){var e=this.ctx.helper,i=this.cvs.helper;i.width=t.width,i.height=t.height,e.clearRect(0,0,i.width,i.height),e.drawImage(t,0,0)},drawGrid:function(t){if(t>=2){var e=this.cvs.helper,i=this.ctx.helper;i.fillStyle="rgba(255, 255, 255, 0.25)";for(var r=0;r<e.width;r+=t)i.fillRect(r,0,1,e.height);for(var s=0;s<e.height;s+=t)i.fillRect(0,s,e.width,1)}},drawProcessed:function(t){var e=this.ctx.preview,i=this.cvs.preview,r=t.data;i.width=t.columns*this.scale,i.height=t.rows*this.scale,e.clearRect(0,0,i.width,i.height),e.fillStyle="#000";for(var s=0;s<r.length;s+=1)if(1==r[s]){var n=s%t.columns*this.scale,a=Math.floor(s/t.columns)*this.scale;e.fillRect(n,a,this.scale,this.scale)}},getHelperCanvas:function(){return this.cvs.helper},getPreviewCanvas:function(){return this.cvs.preview}},e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(4),s=function(t){return t&&t.__esModule?t:{default:t}}(r),n=function(){this.needsUpdate=!0,this.loaded=!1,this.brother=new s.default,this.init()};n.prototype={init:function(){this.threshold=50,this.stretch=1,this.threadcount=200,this.size=10,this.data=[],this.result={}},imageToPixelArray:function(t){this.data=[],this.image=t;var e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.width,e.height=t.height,i.drawImage(t,0,0);for(var r=i.getImageData(0,0,t.width,t.height).data,s=0;s<r.length;s+=4)this.data.push({r:r[s],g:r[s+1],b:r[s+2]});this.fitToImage(),this.loaded=!0},fitToImage:function(){this.size=this.image.width/this.threadcount,this.needsUpdate=!0},setSize:function(t){this.size=t,this.threadcount=Math.min(200,Math.floor(this.image.width/this.size)),this.needsUpdate=!0},setStretch:function(t){this.stretch=t,this.result.stretch=this.stretch,this.needsUpdate=!0},setThreshold:function(t){this.threshold=t,this.needsUpdate=!0},setThreadcount:function(t){this.threadcount=t,this.needsUpdate=!0},getBrightness:function(t){return(t.r+t.g+t.b)/3},process:function(){var t=this.size/this.stretch,e=Math.floor(this.image.height/t);this.result={rows:e,columns:this.threadcount,data:[]};for(var i=0;i<e;i+=1)for(var r=0;r<this.threadcount;r+=1){for(var s=0,n=0,a=Math.floor(r*this.size+Math.floor(i*t)*this.image.width),h=0;h<this.size;h+=1)for(var o=0;o<t;o+=1){var c=a+h+o*this.image.width;c<this.data.length&&(s+=this.getBrightness(this.data[c]),n+=1)}s=0!=n?s/n/255*100:0;var l=s>=this.threshold?0:1;this.result.data.push(l)}this.needsUpdate=!1},save:function(t){if(!this.result.data)throw"Error: No data";var e=this.brother.convert(this.result.data,this.result.rows,this.result.columns),i=new Blob([e],{type:"application/octet-stream"});saveAs(i,t)},getLogs:function(){return this.brother.getLogs()}},e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){};r.prototype={convert:function(t,e,i){var r=new Uint8Array(32768),s=Math.ceil(e/2),n=Math.ceil(i/4),a=Math.ceil(n*e/2),h=s+a,o=4*n-i,c=4*n*e%8!=0;this.writeHeader(r,0,120,e,i,901),this.writeHeader(r,7,0,0,0,902),this.writeConstants(r,120,h);var l=new Uint8Array(s),u=new Uint8Array(a);this.writeInputToPattern(t,u,i,c,o);for(var d=32479,f=l.length-1;f>-1;f-=1)r[d]=l[f],d-=1;for(var g=u.length-1;g>-1;g-=1)r[d]=u[g],d-=1;return this.logs=[],this.writeToLogs("Rows:",e,"Stitches:",i,"Data Size:",t.length,"<br />","Memo Bytes:",s,"Data Bytes:",a,"Row Nibbles:",n,"Offset Data:",c,"Row Padding:",o,"<br />",this.getHeader(r,0),"<br />",this.sampleHex(u)),r},copyValue:function(t,e,i,r){for(;i>0;)i-=1,t[e+i]=r},writeInputToPattern:function(t,e,i,r,s){for(var n=r?4:0,a=0;a<t.length;a+=1){var h=1;a%i==0&&(h+=s,n+=s);var o=Math.floor(n/8);e[o]<<=h,e[o]|=t[a],n+=1}},writeIndex:function(t,e,i,r){for(var s=0;i>0;)i-=1,t[e+s]=r>>8*i&255,s+=1},decimalToNibble3:function(t){return((255&Math.floor(t/100))<<8)+((255&Math.floor(t%100/10))<<4)+(t%10&255)},writeHeader:function(t,e,i,r,s,n){var a=this.decimalToNibble3(r),h=this.decimalToNibble3(s);this.writeIndex(t,e+0,2,this.decimalToNibble3(i)),this.writeIndex(t,e+2,3,(a<<12)+h),this.writeIndex(t,e+5,2,this.decimalToNibble3(n))},writeConstants:function(t,e,i){var r=e+i;this.copyValue(t,32487,25,0),this.writeIndex(t,32512,2,r),this.writeIndex(t,32514,2,1),this.writeIndex(t,32524,4,33536),this.writeIndex(t,32528,2,32754),this.writeIndex(t,32530,2,0),this.writeIndex(t,32532,3,0),this.copyValue(t,32535,25,0),this.copyValue(t,32560,186,0),this.copyValue(t,32748,19,0),this.writeIndex(t,32746,2,10497),this.writeIndex(t,32764,4,805310512)},writeToLogs:function(){for(var t="",e=0;e<arguments.length;e+=1)t+=" "+arguments[e];this.logs.push(t)},getLogs:function(){return this.logs.join("<br />")},getHeader:function(t,e){for(var i="HEADER ",r=0;r<7;r+=1)i+=t[e+r].toString(16)+" ";return i},sampleHex:function(t){for(var e="SAMPLE: ",i=0;i<t.length&&i<16;i+=1){e+=t[i].toString(16)+" "}return e}},e.default=r}]);